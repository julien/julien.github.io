function b(a,c){return Math.random()*(c-a)+a}function g(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function h(a){var c=g(a);0!==c&&1!==c&&(a[0]/=c,a[1]/=c)}function k(a){var c=l;a[0]*a[0]+a[1]*a[1]>c*c&&(h(a),a[0]*=c,a[1]*=c)}function n(a,c){p[a]+=c[0];q[a]+=c[1];var d=2*c[0];r[a]+=d;t[a]+=d}var l=50,u=40,v=100,w=200,x=v,p=Array(2E3),q=Array(2E3),y=Array(2E3),z=Array(2E3),r=Array(2E3),t=Array(2E3),A=Array(2E3),B=Array(2E3),C=Array(2E3),D=document.getElementById("canvas");D.width=innerWidth;
D.height=innerHeight;var E=D.getContext("webgl"),F=D.clientWidth,G=D.clientHeight,H=new Float32Array([2/F,0,0,0,0,-2/G,0,0,0,0,1,1,-1,1,0,0]),I=0,J=.5*F,K=.5*G,L=[0,0,J+b(-200,200),K+b(-200,200),b(.02,.3),b(.02,.3)];document.body.addEventListener("mousemove",function(a){L[2]=a.clientX;L[3]=a.clientY});for(var M=0;2E3>M;M++){p[M]=0;q[M]=0;y[M]=J+b(-300,300);z[M]=K+b(-300,300);var N=3+b(0,4);r[M]=N;t[M]=N;A[M]=0;B[M]=0;C[M]=[y[M],z[M]]}
var O=document.getElementById("vsrc").innerText,P=document.getElementById("fsrc").innerText,Q=E.createProgram(),R;E.shaderSource(R=E.createShader(E.VERTEX_SHADER),O);E.compileShader(R);E.attachShader(Q,R);E.shaderSource(R=E.createShader(E.FRAGMENT_SHADER),P);E.compileShader(R);E.attachShader(Q,R);E.linkProgram(Q);E.useProgram(Q);E.viewport(0,0,E.canvas.clientWidth,E.canvas.clientHeight);E.enable(E.BLEND);E.blendFunc(E.SRC_ALPHA,E.ONE_MINUS_SRC_ALPHA);E.clearColor(0,0,0,1);
var T=E.getAttribLocation(Q,"a_position"),U=new Float32Array(24E3),V=E.createBuffer(E.ARRAY_BUFFER);E.bindBuffer(E.ARRAY_BUFFER,V);E.bufferData(E.ARRAY_BUFFER,U,E.DYNAMIC_DRAW);E.enableVertexAttribArray(T);E.vertexAttribPointer(T,2,E.FLOAT,!1,0,null);E.uniformMatrix4fv(E.getUniformLocation(Q,"u_matrix"),!1,H);W();
function W(){requestAnimationFrame(W);var a=L[2]-L[0],c=L[3]-L[1];1>Math.abs(a)&&1>Math.abs(c)?(L[2]=.5*F+b(-200,200),L[3]=.5*G+b(-200,200),L[4]=b(.02,.1),L[5]=b(.02,.1),l=b(40,80),u=b(50,60),v=b(20,100),w=b(v,v+100),x=b(v,w)):(c*=L[5],L[0]+=a*L[4],L[1]+=c);for(a=0;2E3>a;a++){y[a]+=A[a];z[a]+=B[a];A[a]+=p[a];B[a]+=q[a];p[a]=0;q[a]=0;c=a;var d=C[a],e=[0,0];d=[d[0]-y[c],d[1]-z[c]];var f=u,m=g(d);100>m&&(f=(m-0)/100*(u-0));m=d;h(m);m[0]*=f;m[1]*=f;e[0]=d[0]-A[c];e[1]=d[1]-B[c];k(e);c=e;e=b(.09,.1);c[0]*=
e;c[1]*=e;e=a;f=L;d=[0,0];f=[f[0]-y[e],f[1]-z[e]];if(g(f)<x){m=f;var S=u;h(m);m[0]*=S;m[1]*=S;f[0]*=-1;f[1]*=-1;d[0]=f[0]-A[e];d[1]=f[0]-B[e];k(d)}e=b(.2,.6);d[0]*=e;d[1]*=e;n(a,c);n(a,d);c=y[a];e=z[a];d=r[a];f=t[a];U[I++]=c;U[I++]=e;U[I++]=c+d;U[I++]=e+f;U[I++]=c;U[I++]=e+f;U[I++]=c;U[I++]=e;U[I++]=c+d;U[I++]=e;U[I++]=c+d;U[I++]=e+f}E.clear(E.COLOR_BUFFER_BIT);E.bufferSubData(E.ARRAY_BUFFER,0,U);E.drawArrays(E.TRIANGLES,0,6*I);I=0};
