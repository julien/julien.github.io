function b(a,c){return Math.random()*(c-a)+a}function g(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function h(a){var c=g(a);0!==c&&1!==c&&(a[0]/=c,a[1]/=c)}function k(a){4E4<a[0]*a[0]+a[1]*a[1]&&(h(a),a[0]*=200,a[1]*=200)}var l=80,n=Array(1E3).fill(0),p=Array(1E3).fill(0),q=Array(1E3).fill(0),r=Array(1E3).fill(0),t=Array(1E3).fill(0),u=Array(1E3).fill(0),v=Array(1E3).fill(0),w=Array(1E3).fill(0),x=Array(1E3).fill([0,0]),y=document.getElementById("canvas");y.width=innerWidth;y.height=innerHeight;
for(var z=y.getContext("webgl"),A=y.clientWidth,B=y.clientHeight,C=new Float32Array([2/A,0,0,0,0,-2/B,0,0,0,0,1,1,-1,1,0,0]),D=0,E=.5*A,F=.5*B,G=[0,0,E+b(-200,200),F+b(-200,200),b(.09,.3),b(.09,.1)],H=0;1E3>H;H++){n[H]=0;p[H]=0;q[H]=E+b(-300,300);r[H]=F+b(-300,300);var I=3+b(0,4);t[H]=I;u[H]=I;v[H]=0;w[H]=0;x[H]=[q[H],r[H]]}var J=document.getElementById("vsrc").innerText,K=document.getElementById("fsrc").innerText,L=z.createProgram(),M;z.shaderSource(M=z.createShader(z.VERTEX_SHADER),J);z.compileShader(M);
z.attachShader(L,M);z.shaderSource(M=z.createShader(z.FRAGMENT_SHADER),K);z.compileShader(M);z.attachShader(L,M);z.linkProgram(L);z.useProgram(L);z.viewport(0,0,z.canvas.clientWidth,z.canvas.clientHeight);z.enable(z.BLEND);z.blendFunc(z.SRC_ALPHA,z.ONE_MINUS_SRC_ALPHA);z.clearColor(0,0,0,1);var N=z.getAttribLocation(L,"a_position"),O=new Float32Array(12E3),P=z.createBuffer(z.ARRAY_BUFFER);z.bindBuffer(z.ARRAY_BUFFER,P);z.bufferData(z.ARRAY_BUFFER,O,z.DYNAMIC_DRAW);z.enableVertexAttribArray(N);
z.vertexAttribPointer(N,2,z.FLOAT,!1,0,null);z.uniformMatrix4fv(z.getUniformLocation(L,"u_matrix"),!1,C);Q();function R(a,c){n[a]+=c[0];p[a]+=c[1];var d=2*c[0];t[a]+=d;u[a]+=d}
function Q(){requestAnimationFrame(Q);var a=G[2]-G[0],c=G[3]-G[1];1>Math.abs(a)&&1>Math.abs(c)?(G[2]=.5*A+b(-200,200),G[3]=.5*B+b(-200,200),G[4]=b(.02,.1),G[5]=b(.02,.1),l=b(80,200)):(c*=G[5],G[0]+=a*G[4],G[1]+=c);z.clear(z.COLOR_BUFFER_BIT);for(a=0;1E3>a;a++){q[a]+=v[a];r[a]+=w[a];v[a]+=n[a];w[a]+=p[a];n[a]=0;p[a]=0;c=a;var d=x[a],e=[0,0];d=[d[0]-q[c],d[1]-r[c]];var f=40,m=g(d);100>m&&(f=(m-0)/100*40);m=d;h(m);m[0]*=f;m[1]*=f;e[0]=d[0]-v[c];e[1]=d[1]-w[c];k(e);c=e;e=b(.09,.1);c[0]*=e;c[1]*=e;e=a;
f=G;d=[0,0];f=[f[0]-q[e],f[1]-r[e]];g(f)<l&&(m=f,h(m),m[0]*=40,m[1]*=40,f[0]*=-1,f[1]*=-1,d[0]=f[0]-v[e],d[1]=f[0]-w[e],k(d));e=b(.2,.6);d[0]*=e;d[1]*=e;R(a,c);R(a,d);c=q[a];e=r[a];d=t[a];f=u[a];O[D+0]=c;O[D+1]=e;O[D+2]=c+d;O[D+3]=e+f;O[D+4]=c;O[D+5]=e+f;O[D+6]=c;O[D+7]=e;O[D+8]=c+d;O[D+9]=e;O[D+10]=c+d;O[D+11]=e+f;++D;z.bindBuffer(z.ARRAY_BUFFER,P);z.bufferSubData(z.ARRAY_BUFFER,0,O);z.drawArrays(z.TRIANGLES,0,6*D);D=0}};
