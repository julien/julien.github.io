<!DOCTYPE html>
<html>
<head>
  <style>
    body{margin:0;width:100%;height:100%;overflow:hidden}
  </style>
</head>
<body>
  <script src="assets/pixi.dev.200.js"></script>
  <script src="assets/anim.js"></script>
  <script src="assets/mover.js"></script>
  <script src="assets/menu.js"></script>
  <script>
    window.onload = function () {

      var screenW
        , screenH
        , stage
        , renderer
        , canvas
        , spriteBatch
        , factor = 1
        , numMovers = 300
        , startTime;

      function addMover(m, x, y) {
        var mover = new Mover(m, x, y);
        spriteBatch.addChild(mover);
      }

      function addMovers() {
        var i = 0
          , l = screenW / 4
          , r = screenW / 2 + l
          , t = screenH / 4
          , b = screenH / 2 + t;

        for ( ; i < numMovers; i++) {
          addMover(randomRange(0.3, 4), randomRange(l, r), randomRange(t, b));
        }
      }

      function update() {
        var it, i, j, a, b, force;

        it = spriteBatch.children.length - 1;

        for (i = it; i >= 0; i--) {
          for (j = it; j >= 0; j--) {
            if (i !== j) {
              force = spriteBatch.children[j].attract(spriteBatch.children[i]);
              force.x *= factor;
              force.y *= factor;
              spriteBatch.children[i].applyForce(force);
            }
          }
          spriteBatch.children[i].update();
          spriteBatch.children[i].checkEdges();
        }

        renderer.render(stage);
        requestAnimationFrame(update);
      }

      function init() {
        screenW = window.innerWidth;
        screenH = window.innerHeight;

        startTime = Date.now();

        stage = new PIXI.Stage(0x000000);
        renderer = PIXI.autoDetectRenderer(screenW, screenH, {antialias: false});
        document.body.appendChild(renderer.view);

        spriteBatch = new PIXI.SpriteBatch();
        stage.addChild(spriteBatch);

        addMovers();
        update();
      }

      document.body.addEventListener('click', function () {
        factor *= -1;
      });

      init();
    };

  </script>
</body>
</html>
